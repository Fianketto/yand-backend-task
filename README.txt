Описание сервиса REST API и проведенных тестов.

Содержание.
1. Структура репозитория
2. Использованные Python-библиотеки
3. Установка пакетов для работы сервиса
4. Распознаваемые ошибки в запросах
5. Запуск и тестирование сервиса
6. Автоматическое возобновление работы REST API


======================================================
==	1. Структура репозитория						
======================================================
Предполагается, что файлы находятся в директории /home/entrant/Orkhan/Python_serv. При перемещении файлов в другую директорию необходимо соответствующим образом переписать также путь path_to_serv в модуле Functions.py (8-ая строка) 

Info		- содержит таблицу с описаниями тестов и файл с командами для установки пакетов
Req_classes	- содержит обработчики Handler_X.py в отдельных файлах и модуль Functions.py для их работы;
SQL_DB		- содержит файл базы данных, в которую добавляются импортируемые данные о гражданах;
Testing		- содержит 4 папки:
	Data_to_import	- содержит файлы с данными граждан для тестирования обработчиков POST и PATCH
	Response_log	- содержит файлы с логами работы сервиса: каждому запуску сервиса соответствует отдельный файл, в который записываются все запросы за текущий сеанс; название файла - время первого запроса за текущий сеанс; файл становится доступным после остановки сервиса;
	Scripts			- содержит вспомогательные скрипты для генерации тестовых данных и автоматического вызова обработчиков;
	Other files		- содержит "сырые" данные для получения из них тестовых данных;


======================================================
==	2. Использованные Python-библиотеки				
======================================================
Сервис написан на Python3. Для работы сервиса необходимо подключение следующих библиотек:
	1. flask (flask-jsonpify, flask-restful)	- микрофреймворк для написания веб-приложений
	2. sqlite3	- встраиваемая БД (для хранения импортируемых данных)
	3. json
	4. datetime
	5. numpy


======================================================
==	3. Установка пакетов для работы сервиса			
======================================================
На виртуальной машине 84.201.153.2 уже установлены все необходимые пакеты для работы сервиса. Установка дополнительных пакетов не требуется. В случае переноса сервиса на другую машину можно воспользоваться командами, которые приведены в файле Info/installations.txt.


======================================================
==	4. Распознаваемые ошибки в запросах
======================================================
При некорректном запросе сервис не только вернет статус 400 BAD REQUEST, но также укажет, в какой части данных (или строки запроса) присутствует ошибка (исключение - дублирование citizen_id: в этом случае не будет указано явно, какой именно citizen_id не уникален, а будет лишь выдана соответствующая ошибка).
Сервис явно укажет о следующих ошибках:
	- формат входных данных не JSON
	- лишняя пара ключ-значение помимо citizens:[ ]
	- отсутствие/дублирование необходимых ключей
	- неправильный тип/формат значения в любой из пар ключ-значение
	- лишние ключи внутри списка citizens
	- несоответствие родственных связей
	- дублирование citizen_id в списке граждан или в списке родственных связей
	- несуществующий citizen_id в родственных связях
	- запрос данных с несуществующим import_id
	- изменение данных у гражданина с несуществующим citizen_id. 


======================================================
==	5. Запуск и тестирование сервиса
======================================================
Для запуска сервиса необходимо в корневой папке выполнить команду python3 MAIN.py; После этого из другого терминального окна можно отправлять запросы и тестировать сервис. Одновременно можно посылать несколько запросов.

- В файле Info/All_tests.xlsx приведен полный перечень проведенных тестов, их описание и результаты;
- В качестве тестовых данных использовались файлы из директорий Testing/Data_to_import/POST и Testing/Data_to_import/PATCH;
- Для отправки запросов использовалась программа cURL (команды cURL приведены в файле Info/All_tests.xlsx);
- Для автоматизации отправки запросов через cURL использовался скрипт Testing/Scripts/send_requests.py;
- Логи работы сервиса записывались в файлы из директории Testing/Response_log;

На текущий момент при запуске будет подключена новая (пустая) база данных SQL_DB/CITIZENS.db, в которую будут добавляться импортируемые данные. Тестовые данные добавлялись в базу данных SQL_DB/TEST_BASE_CITIZENS.db. При желании можно подключить именно эту БД или сформировать любую другую. Для этого нужно указать соответствующее название в 10-ой строке модуля Req_classes/Functions.py перед запуском сервиса. Подключение новой БД может понадобиться при возникновении желания протестировать сервис заново "с нуля", т.е. когда предыдущие тестовые запросы (а именно, POST) не должны влиять на текущие ответы сервиса.
Например: В базу SQL_DB/DB1.db успешно импортируются данные, они получают идентификатор 100. Далее по запросу GET /imports/100/citizens ожидается список жителей из указанного набора, и этот список будет успешно получен. Однако что, если хочется переставить сервис на другую машину и начать тестировать заново? Если первым же запросом на новой машине будет GET /imports/100/citizens, то тестировщик будет ожидать статус 4ХХ (т.к., по идее, еще ничего не импортировано), но в результате получит импортированные ранее (на старой машине) данные. Чтобы избежать этого, необходимо либо удалить существующую БД DB1.db в папке SQL_DB, либо подключить новую БД SQL_DB/DB2.db.


======================================================
==	6. Автоматическое возобновление работы REST API
======================================================

Для автоматического возобновления работы REST API команда запуска скрипта MAIN.py добавлена в системный файл /etc/rc.local; а также в скрипте MAIN.py добавлены строки:
sys.path.append("/usr/local/lib/python3.6/dist-packages/")
sys.path.append("/usr/lib/python3/dist-packages/")
sys.path.append("/usr/lib/python3.6/")



